---
title: "Labour Market Analysis February 2017"
output: 
  flexdashboard::flex_dashboard:
    logo: logolw.png
    social: [ "twitter", "facebook", "menu" ]
    css: styles.css
    self_contained: false
    keep_md: yes
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(zoo)
library(XLConnect)
library(chron)
library(RCurl)
library(scales)
library(ggthemes)
library(readr)
library(readODS)
library(plotly)
require(grid)
require(reshape2)
source("lwi_pal.R")
library(extrafont)
loadfonts(device="win")

currentdate <- Sys.Date()
load("F:/R&C/Data/Recession_watch/monthly_stats/.RData")
stable <- c("was stable at", "showed no change at", "showed little change at")
down <- c("has fallen by", "fell by", "is down by", "decreased by", "reduced by")
up <- c("is up by", "rose by", "has risen by", "increased by")
updown <- function(x) {ifelse(x < 0, sample(down,1), ifelse(x >0, sample(up,1), sample(stable,1)))}
download_address <- "./lms_17_05_2017"
lfsdate <- "Jan-Mar 2017"
lfs_expanded <- "January to March 2017"
claimantdate <- "2017 Apr"
jsaloneparentdate <- "Dec"
vacsdate <- "Feb-Apr 2017"
bensdate <- "2016-Aug"
dates_for_thresholds <- c("Apr 2016", "Jul 2016", "Oct 2016","Jan 2017", "Apr 2017")
dateforpngs <- paste0(months(currentdate), years(currentdate))


### CHECK COLUMN FOR REGION NAMES to go in regionrownames

#### CHANGE MONTH for charts in html writing section

esa_ib_ee <- c(2455, 2455, 2450, 2450, 2440, 2430)
is_lp_ee <- c(410, 405, 400, 400, 395, 395)
eestart <- c(2016,9)


#standard
template_address <- "./"
excel_files <- list.files(download_address)
needed_files <- c("a02sa", "a06sa", "a07", "ben02", "ben03", "cla02", "emp01sa", "hour01sa", "inac01sa", "unem01sa", "vacs01", "jsalp", "ben01", "cla01")

#following Richard Clegg advice, cla01 and cla02 renamed to ben02 and ben03 but cla01 added back at end for claimant count inc

#identify_needed_files <- function(x)(grep(paste0("^",needed_files[x]), excel_files))


overallrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
overallheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
overallheaders <- names(overallheaders)
maleoverallheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=2, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
maleoverallheaders <- names(maleoverallheaders)
femaleoverallheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=3, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
femaleoverallheaders <- names(femaleoverallheaders)

overallstartrows <- grep("Jan-Mar 1971", overallrownames[,1])
overallendrows <- grep(lfsdate, overallrownames[,1])

youthrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[2]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
youthheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[2]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
youthheaders <- names(youthheaders)

youthstartrows <- grep("Mar-May 1992", youthrownames[,1])
youthendrows <- grep(lfsdate, youthrownames[,1])

regionrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[3]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=2, endCol=2)
regionstartrows <- grep("North East", regionrownames[,1])
regionendrows <- grep("Northern Ireland", regionrownames[,1])

hourrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
hourheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
hourheaders <- names(hourheaders)
malehourheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=2, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
malehourheaders <- names(malehourheaders)
femalehourheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=3, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
femalehourheaders <- names(femalehourheaders)


hourstartrows <- grep("Jan-Mar 1971", hourrownames[,1])
hourendrows <- grep(lfsdate, hourrownames[,1])

duration_ilorownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[10]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
duration_iloheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[10]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
duration_iloheaders <- names(duration_iloheaders)

duration_ilostartrows <- grep("Mar-May 1992", duration_ilorownames[,1])
duration_iloendrows <- grep(lfsdate, duration_ilorownames[,1])

inactrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[9]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
inactheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[9]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
inactheaders <- names(inactheaders)
inactstartrows <- grep("Mar-May 1992", inactrownames[,1])
inactendrows <- grep(lfsdate, inactrownames[,1])

involuntrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
involuntheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=1, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
involuntheaders <- names(involuntheaders)

maleinvoluntheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=2, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
maleinvoluntheaders <- names(maleinvoluntheaders)
femaleinvoluntheaders <-readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=3, header=TRUE, startCol=2, startRow=8, endRow=8, colTypes="character")
femaleinvoluntheaders <- names(femaleinvoluntheaders)

involuntstartrows <- grep("Mar-May 1992", involuntrownames[,1])
involuntendrows <- grep(lfsdate, involuntrownames[,1])

allclaimantrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=2, endCol=2)
maleclaimantrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=2, header=FALSE, startCol=2, endCol=2)
femaleclaimantrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=3, header=FALSE, startCol=2, endCol=2)
durationclaimantrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[5]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=2, endCol=2)

claimants2rownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[14]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1 )
ageclaimants2rownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[6]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
#loneparentclaimantrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[12]),excel_files, value=TRUE)), sheet=2, header=FALSE, startCol=1, endCol=1, startRow=5)

allclaimantstart <- grep("1971 Jan", allclaimantrownames[,1])
allclaimantend <- grep(claimantdate, allclaimantrownames[,1])
maleclaimantstart <- grep("1971 Jan", maleclaimantrownames[,1])
maleclaimantend <- grep(claimantdate, maleclaimantrownames[,1])
femaleclaimantstart <- grep("1971 Jan", femaleclaimantrownames[,1])
femaleclaimantend <- grep(claimantdate, femaleclaimantrownames[,1])
durationclaimantstart <- grep("1997 Apr", durationclaimantrownames[,1])
durationclaimantend <- grep(claimantdate, durationclaimantrownames[,1])

claimant2start <- grep("1971 Jan", claimants2rownames[,1])
claimant2end <- grep(claimantdate, claimants2rownames[,1])

ageclaimant2start <- grep("1997 Apr", ageclaimants2rownames[,1])
ageclaimant2end <- grep(claimantdate, ageclaimants2rownames[,1])



vacancyrownames <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[11]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol=1, endCol=1)
vacancystart <- grep("Apr-Jun 2001", vacancyrownames[,1])
vacancyend <- grep(vacsdate, vacancyrownames[,1])


overall  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=overallstartrows, endRow=overallendrows)
maleallage  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=2, header=FALSE, startRow=overallstartrows, endRow=overallendrows)
femaleallage  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=3, header=FALSE, startRow=overallstartrows, endRow=overallendrows)
names(overall) <- c("Date", overallheaders)
names(maleallage) <- c("Date", maleoverallheaders)
names(femaleallage) <- c("Date", femaleoverallheaders)

# workage  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=overallstartrows[4], endRow=overallendrows[4])
# male_workage  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=overallstartrows[5], endRow=overallendrows[5])
# female_workage  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[1]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=overallstartrows[6], endRow=overallendrows[6])
#
unemall  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[10]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=duration_ilostartrows, endRow=duration_iloendrows)
# unem1824  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[10]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=duration_ilostartrows[4], endRow=duration_iloendrows[4])
#
names(unemall) <- c("Date", duration_iloheaders)

youth  <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[2]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=youthstartrows, endRow=youthendrows)
names(youth) <- c("Date", youthheaders)

claimants <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=allclaimantstart, endRow=allclaimantend, colTypes=c(rep("character",2),rep("numeric",6)))
claimants_thousands <- data.frame(lapply(claimants[,c(3,5,6,7)], FUN=function(x)(x*1000)))
male_claimants <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=2, header=FALSE, startRow=maleclaimantstart, endRow=maleclaimantend, colTypes=c(rep("character",2),rep("numeric",6)))
male_claimants_thousands <- data.frame(lapply(male_claimants[,c(3,5,6,7)], FUN=function(x)(x*1000)))
female_claimants <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[4]),excel_files, value=TRUE)), sheet=3, header=FALSE, startRow=femaleclaimantstart, endRow=femaleclaimantend, colTypes=c(rep("character",2),rep("numeric",6)))
female_claimants_thousands <- data.frame(lapply(female_claimants[,c(3,5,6,7)], FUN=function(x)(x*1000)))
duration_claimants <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[5]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=durationclaimantstart, endRow=durationclaimantend)

claimants2 <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[14]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=claimant2start, endRow=claimant2end, colTypes=c(rep("character",1),rep("numeric",17)))
claimants2_thousands <- data.frame(lapply(claimants2[,c(2:5, 8:11, 14:17)], FUN=function(x)(x*1000)))
claimants_thousands[,1] <- claimants2_thousands[,4]
male_claimants_thousands[,1] <- claimants2_thousands[,8]
female_claimants_thousands[,1] <- claimants2_thousands[,12]

ageclaimants2 <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[6]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=ageclaimant2start, endRow=ageclaimant2end, colTypes=c(rep("character",1),rep("numeric",22)))
ageclaimants2_thousands <- data.frame(lapply(ageclaimants2[,c(2, 4:7, 9:12, 14:17, 19:22)], FUN=function(x)(x*1000)))

###
loneparent_claimants <-read_ods(paste0(download_address, "/",grep(paste0("^",needed_files[12]),excel_files, value=TRUE)), sheet=2, col_names=FALSE, skip=4, col_types=cols(
    A = col_date("%b-%y"),
    B = col_number(),
    C = col_number(),
    D = col_number(),
    E = col_number(),
    F = col_number(),
    G = col_number(),
    H = col_number()
))
loneparent_claimants <- na.trim(loneparent_claimants)


bens_claimants <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[13]),excel_files, value=TRUE)), sheet=1, header=FALSE, startCol =4, startRow=6, colTypes=rep("numeric",5))
bens_claimants <- na.trim(bens_claimants)
###

involunt_emp <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=involuntstartrows, endRow=involuntendrows)
names(involunt_emp) <- c("Date", involuntheaders)
maleinvolunt_emp <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=2, header=FALSE, startRow=involuntstartrows, endRow=involuntendrows)
names(maleinvolunt_emp) <- c("Date", maleinvoluntheaders)
femaleinvolunt_emp <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[7]),excel_files, value=TRUE)), sheet=3, header=FALSE, startRow=involuntstartrows, endRow=involuntendrows)
names(femaleinvolunt_emp) <- c("Date", femaleinvoluntheaders)


hours <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=hourstartrows, endRow=hourendrows)
names(hours) <- c("Date", hourheaders)
male_hours <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=2, header=FALSE, startRow=hourstartrows, endRow=hourendrows)
names(male_hours) <- c("Date", malehourheaders)
female_hours <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[8]),excel_files, value=TRUE)), sheet=3, header=FALSE, startRow=hourstartrows, endRow=hourendrows)
names(female_hours) <- c("Date", femalehourheaders)

inactivity <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[9]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=(inactstartrows[1]+12), endRow=inactendrows[1])
names(inactivity) <- c("Date", inactheaders)
#duration_ilo <- unemall
duration_ilo <- unemall

vacancies <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[11]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=vacancystart, endRow=vacancyend, colTypes=c(rep("character",2), rep("numeric",4)))
#regions
regionstocks <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[3]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=regionstartrows[1], endRow=regionendrows[1])
regionstocks <- regionstocks[,c(2:4,6:7,9:10, 12:13)]
regionquarter <- readWorksheetFromFile(paste0(download_address, "/",grep(paste0("^",needed_files[3]),excel_files, value=TRUE)), sheet=1, header=FALSE, startRow=regionstartrows[2], endRow=regionendrows[2])
regionquarter <- regionquarter[,c(2:4,6:7,9:10, 12:13)]


xlcFreeMemory()
library(XLConnect)
library(zoo)
library(forecast)
off_flowsloc <- paste(download_address,"/youth_off_flows_", as.character.Date(Sys.Date()), ".xls", sep="")
download.file("http://www.nomisweb.co.uk/livelinks/3347.xls?namedranges=yes", off_flowsloc, mode="wb")
youth_off_flows <- readNamedRegionFromFile(off_flowsloc, name = "T1_Data")

# Transform to time series or zoo objects
zooyoff <- as.zoo(ts(youth_off_flows[,1],start=c(1998,1),frequency = 12))
stl_zooyoff <- stl(zooyoff[,1], "periodic")
sa_zooyoff <- as.zoo(rollmean(seasadj(stl_zooyoff),3))
sum5sa_zooyoff <- lag(rollapply(sa_zooyoff,3,sum),-3) # Now changed to three-month total
writeWorksheetToFile(paste0(download_address,"/sa_zoo_youth_off.xls"), as.data.frame(sum5sa_zooyoff), sheet="Youth to programmes", rownames="Date")

zoooldoff <- as.zoo(ts(youth_off_flows[,2],start=c(1998,1),frequency = 12))
stl_zoooldoff <- stl(zoooldoff[,1], "periodic")
sa_zoooldoff <- as.zoo(rollmean(seasadj(stl_zoooldoff),3))
sum5sa_zoooldoff <- lag(rollapply(sa_zoooldoff,3,sum),-3) #Changed to 3 month total May 2012
writeWorksheetToFile(paste0(download_address,"/sa_zoo_old_off.xls"), as.data.frame(sum5sa_zoooldoff), sheet="25+ to programmes", rownames="Date")

# Script to download and seasonally adjust rates for flowing through JSA thresholds

#Load packages
library(XLConnect)    # Data access to Excel named ranges
library(zoo)      # Time series package
library(lattice)  # Graphics to display
library(forecast)  # Seasonal adjustment and forecasting
#File location
file_loc <- paste0(download_address, "/seasonal_pars_data.xls")

# Get file from NOMIS
download.file("http://www.nomisweb.co.uk/livelinks/1956.xls?namedranges=yes", file_loc, mode="wb")
# Link to file
# Import data from excel file
T1_stocks_durations <- readNamedRegionFromFile(file_loc, name="T1_Data")

colnames(T1_stocks_durations) <- names(readNamedRegionFromFile(file_loc, name="T1_ColHeadings"))

# closes link to Excel file
# Transform to time series or zoo objects
test_ts <- as.zoo(ts(T1_stocks_durations,start=c(1985,7),frequency = 12))

#create a duplicate table, lagged by -3 months
testlag <- lag(test_ts,-3)
# Create table of original divided by the lagged table, offset by one column
par1 <- test_ts[,2:6]/testlag[,1:5]
# Calculate seasonal factors using decomposition method stl() described in Venables and Ripley (Modern Applied Statistics with S)
par1stltest <- stl(par1[,1], "periodic")
par2stltest <- stl(par1[,2], "periodic")
par3stltest <- stl(par1[,3], "periodic")
par4stltest <- stl(par1[,4], "periodic")
par5stltest <- stl(par1[,5], "periodic")
# similar for the 12-month rate
testlag12 <- lag(test_ts[,1], -12)
par12 <- test_ts[,5]/testlag12
par12stltest <- stl(par12, "periodic")

# Use seasadj() function ( Prof RJ Hyndman, Monash University) to produce adjusted series
seastest1 <- seasadj(par1stltest)
seastest2 <- seasadj(par2stltest)
seastest3 <- seasadj(par3stltest)
seastest4 <- seasadj(par4stltest)
seastest5 <- seasadj(par5stltest)

seastest_12 <- as.zoo(seasadj(par12stltest))

# Put them all together
season_pars <-merge.zoo(seastest1, seastest2, seastest3, seastest4, seastest5)
colnames(season_pars) <- c("Proportion remaining beyond 3 months", "Proportion 3-6 months remaining 6-9 months", "Proportion 6-9 months remaining 9-12 months", "Proportion 9-12 months remaining 12-15 months", "Proportion 12-15 months remaining 15-18 months")

writeWorksheetToFile(paste0(download_address, "/season_pars_out.xlsx"), as.data.frame(season_pars), sheet="Threshold Flows",rownames="Date")
Claimants <- zooreg(claimants2_thousands[,4], start=c(1971,1), frequency=12)
Unemployed <- zooreg(overall[,"MGSC"], start=c(1971,2), frequency=12)
Unemployed_claimant <- merge.zoo(Unemployed, Claimants)
Unemployed_claimant$Nonclaimants <- Unemployed_claimant$Unemployed - Unemployed_claimant$Claimants
Unemployed_claimant$Nonclaimantpercent <- Unemployed_claimant$Nonclaimants / Unemployed_claimant$Unemployed

YClaimants <- zooreg(ageclaimants2_thousands[,9], start=c(1997,4), frequency=12)
YUnemployed <- zooreg(youth[,54], start=c(1992,4), frequency=12)
YUnemployed_claimant <- merge.zoo(YUnemployed, YClaimants)
YUnemployed_claimant$Nonclaimants <- YUnemployed_claimant$YUnemployed - YUnemployed_claimant$YClaimants
YUnemployed_claimant$Nonclaimantpercent <- YUnemployed_claimant$Nonclaimants / YUnemployed_claimant$YUnemployed


```

Headlines 
====================================================

* Unemployment is `r I(format(round(tail(overall,1)[,"MGSC"]/1000)*1000,big.mark=","))`, and `r I(paste(updown(round(diff(tail(overall,2)[,"MGSC"], lag=1))), format(abs(round(diff(tail(overall,2)[,"MGSC"], lag=1)/1000)*1000), big.mark=",")))` from last month's published figure (the quarterly headline `r I(paste(updown(round(diff(tail(overall,4)[,"MGSC"], lag=3)/1000)*1000),format(abs(round(diff(tail(overall,4)[,"MGSC"], lag=3)/1000)*1000), big.mark=",")))`) and the unemployment rate is `r I(round(tail(overall,1)[,"MGSX"],1))`%, `r I(paste(updown(round(diff(tail(overall,2)[,"MGSX"], lag=1),1)), format(abs(round(diff(tail(overall,2)[,"MGSX"], lag=1),1)))))` percentage points on last month and `r I(paste(updown(round(diff(tail(overall,4)[,"MGSX"], lag=3),1)), format(abs(round(diff(tail(overall,4)[,"MGSX"], lag=3),1)))))` percentage points on last quarter. 

* The number of claimant unemployed is `r I(format(round(tail(claimants2,1)[,5],1)*1000, big.mark=","))`, and `r I(paste(updown(diff(tail(claimants2,2)[,5], lag=1)), format(abs(round(diff(tail(claimants2,2)[,5], lag=1),1)*1000), big.mark=",")))` on last month. The claimant rate is `r I(round(tail(claimants2,1)[,6],1))`%. 

* The number of workless young people (not in employment, full-time education or training) is `r I(format(round(sum(tail(youth,1)[,c(54, 55)])/1000)*1000,big.mark=","))`, and `r I(paste(updown(diff(rowSums(tail(youth,4)[,c(54, 55)]),lag=3)), format(abs(round(diff(rowSums(tail(youth,4)[,c(54, 55)]),lag=3)/1000)*1000), big.mark=",")))` on the quarter, representing `r I(round(sum(tail(youth,1)[,c("AGOL", "AGPM")])/tail(youth,1)[,"JN5R"]*100,1))`% of the youth population (`r I(paste(updown(round(diff(rowSums(tail(youth,4)[,c(54, 55)])/tail(youth,4)[,44],lag=3)*100,1)),round(diff(rowSums(tail(youth,4)[,c(54, 55)])/tail(youth,4)[,44],lag=3)*100,1)))`percentage points). 

* Youth unemployment (including students) is `r I(format(round(tail(youth,1)[,46]/1000)*1000,big.mark=","))`, and `r I(paste(updown(diff(tail(youth,4)[,46]/1000, lag=3)),format(abs(round(diff(tail(youth,4)[,46]/1000, lag=3))*1000),big.mark=",")))`on the quarter.

* There are `r I(tail(vacancies,2)[1,5])` unemployed people per vacancy. Learning and Work Institute estimates this figure may fall further next month. 

* The employment rate is `r I(round(tail(overall,1)[,"LF24"],1))`% (and `r I(paste(updown(round(diff(tail(overall,2)[,"LF24"], lag=1),1)), abs(round(diff(tail(overall,2)[,"LF24"], lag=1),1))))`percentage points on last month's published figure and `r I(paste(updown(round(diff(tail(overall,4)[,"LF24"], lag=3),1)), abs(round(diff(tail(overall,4)[,"LF24"], lag=3),1))))` percentage points in the preferred quarterly measure). 



### Comment

 The labour market figures published on 
 15 February
are at first sight a set of positive figures. 


Duncan Melville, Chief Economist at Learning and Work Institute, commented: 


"The picture that emerges from the statistics released today is of a modestly improving labour market. In the last quarter of 2016, employment grew but at a much slower rate that we saw in the first half of the year, unemployment fell very slightly and the numbers of economically inactive (outside the labour market) fell after increasing recently.   


Standing in contrast with moderate positivity, was the large and unexpected fall in claimant unemployment in the month to January - down by over 40,000. This may be the product of Universal Credit having a different seasonal pattern over Christmas from Jobseekers' Allowance. So, the ONS seasonal adjustment of the 'raw' numbers might not be right. Alternatively, a number of commentators, including the Learning and Work Institute, have been drawing attention to some worrying signs that Jobcentre Plus might have been distracted from supporting individuals into work by the ongoing roll out of Universal Credit. Jobcentre Plus will have seen those signs themselves and may now be taking action
."

Employment rose by `r I(format(round(diff(tail(overall,4)[,"MGRZ"], lag=3)/1000)*1000, big.mark=","))` between `r I(last_quarter)` and `r I(lfs_expanded)`. In the last 12 months employment has grown by `r I(format(round(diff(tail(overall,13)[,"MGRZ"], lag=12)/1000)*1000, big.mark=","))`.   

Unemployment fell by `r I(format(round(diff(tail(overall,4)[,"MGSC"], lag=3)/1000)*1000, big.mark=","))` between `r I(last_quarter)` and `r I(lfs_expanded)`. and the unemployment rate fell `r I(diff(round(tail(overall,4)[,"MGSX"],1), lag=3))` percentage points to `r I(round(tail(overall,1)[,"MGSX"],1))`% in the quarter the lowest level since 2005.     

Economic inactivity fell by `r I(format(round(diff(tail(overall,4)[,"LF2M"], lag=3)/1000)*1000, big.mark=","))` between `r I(last_quarter)` and `r I(lfs_expanded)`. and the inactivity rate fell `r I(diff(round(tail(overall,4)[,"LF2S"],1), lag=3))` percentage points to `r I(round(tail(overall,1)[,"LF2S"],1))`% in the quarter, a new record low. 
 
The small rise in the claimant count takes account of normal seasonal effects but adjusted figures are not published for local areas. The actual number of claimants, nationally, rose by `r I(format(round(diff(tail(claimants[,7],2) + tail(claimants2[,3],2),1),1)*1000, big.mark=","))` in the month to `r I(months(strptime(paste(claimantdate, "01"), format="%Y %b %d")))`, compared to the adjusted rise of `r I(format(round(diff(tail(claimants2[,5],2),1),1)*1000, big.mark=","))`. Therefore, it should not be surprising that figures for local areas will show falls compared to the national picture.  

The proportion of people leaving the claimant count (or the 'leavers rate') has risen. At `r I(round(tail(leaver.rate,1)*100,1))`%, it is now well below the level in early 2015 of `r I(round(max(leaver.rate)*100,1))`%. The number of new claims has fallen. Jobseeker's Allowance off-flow rates for JSA claimants of short durations increased. Off-flow rates remain at historically high levels. 

Youth unemployment is showing a quarterly fall. There are still `r I(format(round(tail(youth,1)[,46]/1000)*1000,big.mark=","))` unemployed young people, and `r I(format(round(tail(YUnemployed,1)[,1]/1000)*1000,big.mark=","))`(`r I(round(tail(youth,1)[,54]/tail(youth,1)[,44]*100,1))`% of the youth population) who are unemployed and not in full-time education.  

The proportion of unemployed young people (not counting students) who are not claiming Jobseeker's Allowance and therefore are not receiving official help with job search is now `r I(round(tail(YUnemployed_claimant[,4],3)[1]*100,1))`% and has risen by more than 20 percentage points since October 2012. 
 
A total of `r I(format(round(tail(involunt_emp[,6],1)/1000,0)*1000,big.mark=","))` were counted as in employment while on 'government employment and training programmes', where the Office for National Statistics continues to count Work Programme (etc.) participants as 'in employment' by default. This number fell `r I(format(round(diff(tail(involunt_emp,4)[,6]/1000, lag=3))*1000,big.mark=","))` this quarter. Self-employment rose `r I(format(round(diff(tail(involunt_emp,4)[,4]/1000, lag=3))*1000,big.mark=","))` this quarter and reached a new record proportion of employment. Employee numbers rose `r I(format(round(diff(tail(involunt_emp,4)[,3]/1000, lag=3))*1000,big.mark=","))` in the quarter. Involuntary part-time employment fell this quarter by `r I(format(round(diff(tail(involunt_emp,4)[,22]/1000, lag=3))*1000,big.mark=","))` to `r I(format(round(tail(involunt_emp,1)[,22]/1000000,1)))` million, `r I(format(round(tail(involunt_emp,1)[,23],1)))`% of all part-time workers.The proportion remains nearly double that in 2004.


Unemployment {.storyboard}
============================

### Unemployment is `r I(format(round(tail(overall,1)[,"MGSC"]/1000)*1000,big.mark=","))`, down `r I(format(round(diff(tail(overall,2)[,"MGSC"], lag=1)/1000)*1000, big.mark=","))` from last month's published figure 

```{r chart_1, fig.width= 10, fig.height=8}
unemployed.zoo <-zooreg(overall[,"MGSC"], start=c(1971,2), frequency=12)
maleunemployed.zoo <-tail(zooreg(maleallage[,"MGSD"], start=c(1971,2), frequency=12),25)
femaleunemployed.zoo <-tail(zooreg(femaleallage[,"MGSE"], start=c(1971,2), frequency=12),25)
malejsa.cc <- (tail(zooreg(male_claimants_thousands[,1], start=c(1971,1), frequency=12),27))
femalejsa.cc <- (tail(zooreg(female_claimants_thousands[,1], start=c(1971,1), frequency=12),27))
malejsadiff <- diff(malejsa.cc, arithmetic=FALSE)
femalejsadiff <- diff(femalejsa.cc, arithmetic=FALSE)
maleunemforecast  <- merge.zoo(maleunemployed.zoo, malejsadiff)
femaleunemforecast  <- merge.zoo(femaleunemployed.zoo, femalejsadiff)
maleunemforecast[26,1] <- as.numeric(maleunemforecast[25,1])*as.numeric(maleunemforecast[26,2])
maleunemforecast[27,1] <- as.numeric(maleunemforecast[26,1])*as.numeric(maleunemforecast[27,2])
femaleunemforecast[26,1] <- as.numeric(femaleunemforecast[25,1])*as.numeric(femaleunemforecast[26,2])
femaleunemforecast[27,1] <- as.numeric(femaleunemforecast[26,1])*as.numeric(femaleunemforecast[27,2])


unemforecast <- maleunemforecast[,1] + femaleunemforecast[,1]
unemployed <- tail(unemployed.zoo, 25)
unemployed <- merge(unemforecast, unemployed)
names(unemployed) <- c("L&W forecast", "ILO unemployed")
ggplotly(ggplot(data=fortify(unemployed, melt=TRUE), aes(x = Index, y = Value, group=Series, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + scale_y_continuous(labels=comma) + 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + 
  scale_colour_lwi() + theme(legend.title=element_blank()))

```

***

The latest unemployment figure is `r I(format(round(tail(overall,1)[,"MGSC"]/1000)*1000,big.mark=",")) `. 

It `r I(paste(updown(round(diff(tail(overall,2)[,"MGSC"], lag=1))), format(abs(round(diff(tail(overall,2)[,"MGSC"], lag=1)/1000)*1000), big.mark=",")))` from the figure published last month. On the basis of later claimant count figures, Learning and Work Institute estimates that unemployment may continue to decrease, although this remains highly uncertain. The unemployment rate `r I(paste(updown(round(diff(tail(overall,2)[,"MGSX"], lag=1))),  round(tail(overall,1)[,"MGSX"],1))) `%.


### Chart 2: Percentage unemployed not claiming Jobseeker's Allowance or Universal Credit

```{r chart_2, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(non_claimant_percent, melt=TRUE), aes(x = Index, y = Value, group=1)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + scale_y_continuous(labels=percent) + 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() )
```

***

The proportion of unemployed people not claiming Jobseeker's Allowance or Universal Credit has risen to `r I(round(tail((Unemployed_claimant[,4]*100),3),1)[1])`%, (`r I(format(round((tail((Unemployed_claimant[,3]),3)/1000))[1]*1000, big.mark=",")) `).

The number and proportion of unemployed people not claiming Jobseeker's Allowance have been rising since the new Jobseeker's Allowance sanctions regime started in October 2012.

### Chart 3: Youth long-term unemployment (six months and over, 18-24)

```{r chart_3, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(youth_lt, melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(limits=c(0, max(fortify(youth_lt, melt=TRUE)[,3])),labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() )

```

***

Youth long-term unemployment (which can include students) has risen by `r I(format(round(tail(diff(unemall[,"YBXY"] + unemall[,"YBXV"],1),1)/1000)*1000, big.mark=",")) ` from last month's figure and is now `r I(format(round(sum(tail(unemall[,c("YBXY", "YBXV")],1))/1000)*1000, big.mark=",")) `. 

The youth Jobseeker's Allowance count remains far behind, at `r I(format(sum(tail(duration_claimants[,c(16,19)],1))*1000, big.mark=",")) `. 

The count fell by `r I(format(tail(diff(duration_claimants[,16] + duration_claimants[,19]),1)*1000, big.mark=",")) ` this month. Work Programme participants are included within the count unless they are in paid work. 

###     Chart 4: Adult long-term unemployment (12 months and over, 25+)

```{r chart_4, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(old_lt, melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(limits=c(0, max(fortify(old_lt, melt=TRUE)[,3])),labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() )

```

***

Adult long-term unemployment on the survey measure is now `r I(format(round(sum(tail(unemall[,c("YBYN", "YBZC")],1))/1000)*1000, big.mark=",")) `. 

The Jobseeker's Allowance measure is `r I(format(sum(tail(duration_claimants[,c(28,37)],1))*1000, big.mark=",")) `.


### Chart 5: Unemployment rates by age
```{r chart_5, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(unemployed_age_rates, melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(limits=c(0, max(fortify(unemployed_age_rates, melt=TRUE)[,3])),labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

***

The 18 to 24 year old unemployment rate (including students) is `r I(round(tail(unemall[,"YBVQ"],1),1)) `% of the economically active, excluding one million economically inactive students from the calculation. 

The rate for those aged 25 to 49 is `r I(round(tail(unemall[,"MGXB"],1),1)) `%. 

For those aged 50 and over it is `r I(round(tail(unemall[,"YBVW"],1),1)) `%. 

The quarterly change is up `r I(format(tail(diff(round(unemall[,"YBVQ"],1),3),1))) ` for 18 to 24 year olds, down `r I(format(tail(diff(round(unemall[,"MGXB"],1),3),1))) ` for 25 to 49 year olds, and down `r I(format(tail(diff(round(unemall[,"YBVW"],1),3),1))) ` for the over-50s.


    
### Chart 6: Young people not in employment, full-time education or training

```{r chart_6, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(ypnfte, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```


***

The number of out of work young people who are not in full-time education (`r I(format(round(sum(tail(youth,1)[,c(54, 55)])/1000)*1000,big.mark=",")) `) has fallen in the past quarter by `r I(format(round(tail(diff(rowSums(youth[,c(54, 55)]),lag=3),1)/1000)*1000, big.mark=",")) `, or `r I(round((tail(diff(rowSums(youth[,c(54,55)]),lag=3),1)/tail(rowSums(youth[,54:55]),4)[1])*100,1)) `%. 

The fall was largely among the inactive, with the number of unemployed young people not in full-time education or training falling at a lower rate.

### Chart 7 Youth unemployment


```{r chart_7, fig.width= 10, fig.height=8}
ggplotly(ggplot(data=fortify(yunem, melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(limits=c(0, max(fortify(yunem, melt=TRUE)[,3])),labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

***

The number of unemployed young people has risen by `r  I(format(round(tail(diff(youth[,46],1)/1000,1))*1000,big.mark=","))`since last month's figures, to `r  I(format(round(tail(youth,1)[,46]/1000)*1000,big.mark=","))`. 
    
Meanwhile, the number of young Universal Credit or Jobseeker's Allowance claimants fell last month by `r  I(format(tail(diff(ageclaimants2_thousands[,9]),1), big.mark=","))`, to `r  I(format(round(tail(ageclaimants2_thousands[,9],1),1),big.mark=","))`. 

There are `r  I(format(round(tail(YUnemployed_claimant[,3],3)[1]/1000)*1000,scientific=FALSE, big.mark=","))` unemployed young people who are not in education, and do not claim Jobseeker's Allowance, `r  I(round(tail(YUnemployed_claimant[,4],3)[1]*100,1))`% of all unemployed young people who are not students.

Claimant count {.storyboard}
============================  

### Chart 8: Claimant count stocks

```{r chart_8, fig.width= 10, fig.height=8}
jsa.cc <- (tail(zooreg(claimants2[,5], start=c(1971,1), frequency=12),25))*1000
ggplotly(ggplot(data=fortify(jsa.cc, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

***

The Jobseeker 's Allowance and Universal Credit claimant acount fell by `r I(format(round(diff(tail(claimants2,2)[,5], lag=1),1)*1000, big.mark=",")) ` in `r I(months(strptime(paste(claimantdate, "01"), format="%Y %b %d")))`, taking the total to `r I(format(round(tail(claimants2,1)[,5],1)*1000,big.mark=",")) `. 

In `r I(months(tail(loneparent_claimants,1)[,1])) `, the number of lone parents claiming Jobseeker 's Allowance was `r I(format(tail(loneparent_claimants,1)[,3], big.mark=",")) `. 12.1% of JSA claimants and 8.9% of the JSA/UC claimant count. Lone parents with a youngest child aged five or over can only claim Jobseeker 's Allowance, unless they have other reasons for claiming benefit.


### Chart 9: Jobseeker's Allowance new claims and leavers

```{r chart_9, fig.width= 10, fig.height=8}
jsa.flow <- (tail(zooreg(claimants[,5:6], start=c(1971,1), frequency=12),25))*1000
names(jsa.flow) <- c("New claims", "Leavers")
ggplotly(ggplot(data=fortify(jsa.flow, melt=TRUE), aes(x = Index, y = Value, colour=Series))+ 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

***

The number of new Jobseeker 's Allowance claims fell by `r I(format(diff(tail(claimants,2)[,5]*1000, lag=1), big.mark=","))` this month, to `r I(format(tail(claimants,1)[,5]*1000, big.mark=",")) `.

Meanwhile the number of leavers also fell, by `r I(format(diff(tail(claimants,2)[,6]*1000, lag=1), big.mark=",")) `, to `r I(format(tail(claimants,1)[,6]*1000, big.mark=",")) `.

### Chart 10: Jobseeker’s Allowance – claimant count leavers rate – leavers as percentage of ‘could leave’

```{r chart_10, fig.width= 10, fig.height=8}
jsa.flow2 <- (tail(zooreg(claimants[,c(3,5:6)], start=c(1971,1), frequency=12),26))*1000
leaver.rate <- jsa.flow2[,3]/(lag(jsa.flow2[,1],-1) + jsa.flow2[,2])
ggplotly(ggplot(data=fortify(leaver.rate, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=percent)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

***

Learning and Work Institute estimates that the 'leavers rate', people who have left the claimant count as a proportion of those who could leave it, has risen to `r I(round((tail(claimants[,6],1) / (tail(claimants[,3],2)[1] + tail(claimants[,5],1)))*100,1)) `% after several months of falls.


### Chart 11: Jobseeker’s Allowance – claimants staying through each three-month threshold (seasonally adjusted)

```{r chart_11, fig.width= 10, fig.height=8}
thresholds <- tail(season_pars,25)
names(thresholds) <- c("New claimants staying to 3 months", 
                       "3-6 months staying to 6-9 months", 
                       "6-9 months staying to 9-12 months",
                       "9-12 months staying to 12-15 months",
                       "12-15 months staying to 15-18 months")
p <- ggplot(data=fortify(thresholds, melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=percent)+ 
  guides(colour= guide_legend(title=NULL, nrow=3, byrow=TRUE)) +
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + 
  theme(legend.margin=unit(-0.1,"cm"), legend.background = element_rect(fill=NA),legend.text = element_text(size = rel(1.0), lineheight = 1))+ theme(legend.title=element_blank())
ggplotly(p)
```

***

These measures show an improvement for claimants at all lengths of unemployment, except the shortest term.

The proportion staying beyond three months has risen to `r I(round(tail(season_pars[,1],1)*100,1)) `%. 

Short-term claimants are mainly supported by Jobcentre Plus, although some will be Work Programme participants who have not sustained jobs.


### Chart 12: Jobseeker’s Allowance – proportion of starters in month becoming longer-term unemployed

```{r chart_12, fig.width= 10, fig.height=8}
col1 <- thresholds[,1]
col2 <- lag(thresholds[,2], 3)* thresholds[,1]
col3 <- lag(thresholds[,3],6) *lag(thresholds[,2], 3)* thresholds[,1]
col4 <- lag(thresholds[,4],9) * lag(thresholds[,3],6) *lag(thresholds[,2], 3)* thresholds[,1]
col5 <- lag(thresholds[,5],12) *lag(thresholds[,4],9) * lag(thresholds[,3],6) *lag(thresholds[,2], 3)* thresholds[,1]
cumthresholds <- merge(col1, col2, col3, col4, col5)
cumthresholds <- as.data.frame(t(cumthresholds))
cumthresholds <- cumthresholds[,c(13,16,19,22,25)]
names(cumthresholds) <- dates_for_thresholds
rownames(cumthresholds) <- c("New claimants \nstaying to 3 \nmonths",
                             "New claimants \nstaying to 6-9 \nmonths",
                             "New claimants \nstaying to 9-12 \nmonths",
                             "New claimants \nstaying to 12-15 \nmonths",
                             "New claimants \nstaying to 15-18 \nmonths")
cumthresholds$`Aug 1991` <- c(0.6188826001427, 0.4351983647231, 0.3199537013450,	0.2431893649297,	0.1908346923862
)
cumthresholds$`Jan 2008` <- c(0.4191836714832, 0.2112580981335, 0.1122545263060,	0.0781573350080,	0.0592892049914
)
cumthresholds$group <- factor(row.names(cumthresholds), levels=c("New claimants \nstaying to 3 \nmonths",
                                                                 "New claimants \nstaying to 6-9 \nmonths",
                                                                 "New claimants \nstaying to 9-12 \nmonths",
                                                                 "New claimants \nstaying to 12-15 \nmonths",
                                                                 "New claimants \nstaying to 15-18 \nmonths"))
cumthresholds2 <- melt(cumthresholds, id.vars="group")
p <- ggplot(data=cumthresholds2, aes(x = group, y = value, group=variable, colour=variable)) + 
  geom_line(size=2) + geom_point(size=2) +
  scale_y_continuous(labels=percent, breaks=seq(.1, .6, by=.1))+ 
  guides(colour= guide_legend(title=NULL, nrow=2, byrow=TRUE)) +
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  scale_colour_lwi() +
  xlab(NULL) + ylab(NULL) + 
  theme(legend.spacing=unit(-0.1,"cm"), legend.text = element_text(size = rel(1.0), lineheight = 0.4))+ theme(legend.title=element_blank())
ggplotly(p)
```

***

The proportion of starters becoming 12-month claimants is now `r I(as.character(round(tail(lag(season_pars[,1], -9) * lag(season_pars[,2],-6) * lag(season_pars[,3], -3) * season_pars[,4],1)*100,1))) `%.

This is likely to rise over the next few months as the proportion of starters becoming 9-month claimants has risen by `r I(as.character(round(tail(diff(lag(season_pars[,1], -6) * lag(season_pars[,2],-3) * season_pars[,3], 3),1)*100, 1))) ` percentage points over the last three months.  
 
These figures are based on those in Chart 11, but show the patterns of the same people passing through successive quarterly thresholds.

Employment {.storyboard}
============================  

###Chart 13: Vacancies - whole economy survey
 
```{r chart_13, fig.width= 10, fig.height=8}
vacs <- (tail(zooreg(vacancies[,3], start=c(2001,5), frequency=12),25))*1000
ggplotly(ggplot(data=fortify(vacs, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))
```

 
***

Vacancies (in the Office for National Statistics survey of the whole economy) rose slightly this month, to `r I(format(tail(vacancies,1)[,3]*1000,big.mark=",")) `. 

As the number of vacancies is quite volatile, and frequently revised, the Office for National Statistics uses a three-month average.
            


### Chart 14: Unemployed people per vacancy

```{r chart_14, fig.width= 10, fig.height=8}
upv <- (tail(zooreg(vacancies[,6], start=c(2001,5), frequency=12),25))
upv <- merge(unemployed[,1],upv)
upv_forecast <- upv[,2]
upv_forecast[26] <-as.numeric(unemployed[26,1])/as.numeric(vacs[25])
upv <- merge(upv_forecast, upv[,2])

names(upv) <- c("L&W forecast", "Unemployed per vacancy")
ggplotly(ggplot(data=fortify(upv, melt=TRUE), aes(x = Index, y = Value, colour=Series)) +
  geom_line(size=2) +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))

```

            
***

There are `r I(tail(vacancies,2)[1,5]) ` unemployed people per vacancy.

Learning and Work Institute estimates this figure may fall slightly next month.

### Chart 15: UK employment

```{r chart_15, fig.width= 10, fig.height=8}
empno <- tail(zooreg(overall[,"MGRZ"], start=c(1971,2), frequency=12),25)
ggplotly(ggplot(data=fortify(empno, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))

```


***

Employment rose by `r I(format(round(diff(tail(overall,2)[,"MGRZ"], lag=1)/1000)*1000, big.mark=",")) ` on the figure published last month, to `r I(format(round(tail(overall,1)[,"MGRZ"]/1000)*1000,big.mark=",")) `. 

Employment fell `r I(format(round(diff(tail(overall,4)[,"MGRZ"], lag=3)/1000)*1000, big.mark=","))` between `r I(last_quarter)` and `r I(lfs_expanded)`. 

In the last 12 months employment has grown by `r I(format(round(diff(tail(overall,13)[,"MGRZ"], lag=12)/1000)*1000, big.mark=","))`.

### Chart 16: Employment rate in the UK

```{r chart_16, fig.width= 10, fig.height=8}
emprate <- (tail(zooreg((overall[,"LF24"]/100), start=c(1971,2), frequency=12),25))
ggplotly(ggplot(data=fortify(emprate, melt=TRUE), aes(x = Index, y = Value)) + 
  geom_line(size=2, colour="#ee7e3b") +
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=percent)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_colour_lwi() + theme(legend.title=element_blank()))

```


***

The employment rate rose by `r I(round(diff(tail(overall,4)[,"LF24"], lag=3),1)) ` percentage points over the quarter, to `r I(round(tail(overall,1)[,"LF24"],1)) `%. 

Inactivity {.storyboard}
============================  


### Chart 17: Claimants for inactive benefits and the economically inactive - inactivity benefits

```{r chart_17, fig.width= 10, fig.height=8}
inact_dis <- zooreg(inactivity[,"LF69"], start=c(1993,4), frequency=12)
bens_esaib <- zooreg(bens_claimants[,3], start=c(1999,3), frequency=4)
esa_ee <- zooreg(esa_ib_ee*1000, start=eestart, frequency=12)

inact_dis_bens <- merge(inact_dis, bens_esaib*1000, esa_ee)
inact_dis_bens$ESAIB <- lag(inact_dis_bens[,2],-1) 
inact_dis_bens$ESAIB <- ifelse.zoo(!is.na(inact_dis_bens$ESAIB), inact_dis_bens$ESAIB, inact_dis_bens$esa_ee)
index_base <- as.numeric(inact_dis_bens[224,])
inact_dis_bens$inact_index <- (inact_dis_bens[,1]/index_base[1])*100
inact_dis_bens$claim_index <- (inact_dis_bens[,4]/index_base[4])*100

inact_dis_bens_tail <- tail(inact_dis_bens,27)
names(inact_dis_bens_tail) <- c(
  "Inactive, long term sick or disabled",
  "ESA or IB claimants",
  "ESA early estimates",
  "Combined ESA or IB claimants",
  "Inactive, long term sick", 
  "Incapacity/ESA benefits claimants")
c17 <- ggplot(data=fortify(inact_dis_bens_tail[,5:6], melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  geom_point(size=2) + 
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma) + 
  guides(colour= guide_legend(title=NULL, nrow=2, byrow=TRUE)) +
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab("Index: Oct-Dec 2011 = 100") + 
  scale_colour_lwi() + theme(legend.title=element_blank())
ggplotly(c17)

```


***

The number of people inactive owing to long-term sickness fell, as did the benefit figure. The benefit figures show 'early estimates' of benefit numbers.

This chart shows claimants of Employment and Support Allowance, and Incapacity Benefit (the orange dots), compared with survey figures for the economically inactive owing to long-term sickness.


### Chart 18: Claimants for inactive benefits and the economically inactive - lone parents

```{r chart_18, fig.width= 10, fig.height=8}
inact_parent <- zooreg(inactivity[,"LF65"], start=c(1993,4), frequency=12)
bens_islp <- zooreg(bens_claimants[,4], start=c(1999,3), frequency=4)
islp_ee <- zooreg(is_lp_ee*1000, start=eestart, frequency=12)
jsalp <- zooreg(loneparent_claimants[,3], start=c(2005,4), frequency=12)
inact_parent2 <- merge(inact_parent, bens_islp*1000, islp_ee, jsalp)
inact_parent2$ISLP <- lag(inact_parent2[,2],-1) 
inact_parent2$ISLP <- ifelse.zoo(!is.na(inact_parent2$ISLP), inact_parent2$ISLP, inact_parent2$islp_ee)
inact_parent2$LP_claimants <- inact_parent2[,4] + inact_parent2[,5]

index_base_lp <- as.numeric(inact_parent2[224,])
inact_parent2$inact_index <- (inact_parent2[,1]/index_base_lp[1])*100
inact_parent2$claim_index <- (inact_parent2[,6]/index_base_lp[6])*100

inact_parent_tail <- tail(inact_parent2,27)
names(inact_parent_tail) <- c(
  "Inactive, look after family",
  "IS lone parents",
  "ISlp early estimates",
  "JSA lone parents",
  "Combined IS lone parents",
  "Combined JSA and IS claimants",
  "Inactive, looking after family,home", 
  "Lone parents claiming benefits (IS+JSA)")
c18 <- ggplot(data=fortify(inact_parent_tail[,7:8], melt=TRUE), aes(x = Index, y = Value, colour=Series)) + 
  geom_line(size=2) +
  geom_point(size=2) + 
  scale_x_yearmon(format = "%b %Y") + 
  scale_y_continuous(labels=comma) + 
  guides(colour= guide_legend(title=NULL, nrow=2, byrow=TRUE)) +
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE) + 
  xlab(NULL) + ylab("Index: Oct-Dec 2011 = 100") + 
  scale_colour_lwi() + theme(legend.title=element_blank())
ggplotly(c18)

```      
     
***


The survey figures (showing those looking after family) rose while benefit measures fell slowly.

Income Support estimates have decreased, and those for Jobseeker's Allowance are now falling. Lone parents with a youngest child aged five or six have moved on to Jobseeker's Allowance as part of welfare reform.

This chart shows claimants of Income Support as lone parents, plus lone parents claiming Jobseeker's Allowance (the orange dots) and survey figures for all those who are economically inactive looking after family (including couple families).

Regions {.storyboard}
============================  

### Chart 19: Employment rate quarterly change in regions - `r I(lfs_expanded) `
    
```{r chart_19, fig.width= 10, fig.height=8}
regionemp <- regionquarter[,c(1,5)]
regionemp[,2] <- regionemp[,2]/100
names(regionemp) <- c("Region", "Employment rate change")
regionemp$Region <- factor(regionemp$Region)
regionemp$Region <- reorder(regionemp[,1], regionemp[,2])
ggplot(regionemp, aes(x=Region, y=`Employment rate change`)) + 
  geom_bar(stat="identity", fill="#ee7e3b") +
  coord_flip()+ 
  scale_y_continuous(labels=percent)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE,horizontal=FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_fill_lwi() + theme(legend.title=element_blank())

```


***

This quarter, `r I(sum(regionemp[,2] > 0)) ` regions showed a rise in the employment rate, led by the `r I(as.character(regionemp[12,1])) ` and `r I(as.character(regionemp[11,1])) `. 

The employment rate fell in `r I(sum(regionemp[,2] < 0)) ` regions, led by the `r I(as.character(regionemp[1,1])) ` and `r I(as.character(regionemp[2,1])) `.




### Chart 20: Unemployment rate quarterly change in regions - `r I(lfs_expanded) `

```{r chart_20, fig.width= 10, fig.height=8}
regionunemp <- regionquarter[,c(1,7)]
regionunemp[,2] <- regionunemp[,2]/100
names(regionunemp) <- c("Region", "Unemployment rate change")
regionunemp$Region <- factor(regionunemp$Region)
regionunemp$Region <- reorder(regionunemp[,1], regionunemp[,2])
ggplot(regionunemp, aes(x=Region, y=`Unemployment rate change`)) + 
  geom_bar(stat="identity", fill="#ee7e3b") +
  coord_flip()+ 
  scale_y_continuous(labels=percent)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE,horizontal=FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_fill_lwi() + theme(legend.title=element_blank())

```


***

`r I(sum(regionunemp[,2] < 0)) ` regions showed an improvement in the unemployment rate this quarter. 

`r I(sum(regionunemp[,2] > 0)) ` showed a worsening. 

The rises were led by the `r I(as.character(regionunemp[12,1])) ` and the `r I(as.character(regionunemp[11,1])) `.
    

### Chart 21: Inactivity rate quarterly change in regions - `r I(lfs_expanded) `

```{r chart_21, fig.width= 10, fig.height=8}
regioninact <- regionquarter[,c(1,9)]
regioninact[,2] <- regioninact[,2]/100
names(regioninact) <- c("Region", "Inactivity rate change")
regioninact$Region <- factor(regioninact$Region)
regioninact <- dplyr::arrange(regioninact, `Inactivity rate change`)
regioninact$Region <- reorder(regioninact[,1], regioninact[,2])
ggplot(regioninact, aes(x=Region, y=`Inactivity rate change`)) + 
  geom_bar(stat="identity", fill="#ee7e3b") +
  coord_flip()+ 
  scale_y_continuous(labels=percent)+ 
  theme_economist_white(base_size=12, base_family="Raleway", gray_bg = FALSE,horizontal=FALSE) + 
  xlab(NULL) + ylab(NULL) + scale_fill_lwi() + theme(legend.title=element_blank())

```


***

Overall, there was a `r I(round(diff(tail(workage,4)[,18],lag=3),1)) ` percentage point fall in the inactivity rate. 

`r I(sum(regioninact[,2] > 0)) ` regions showed rises in inactivity, led by the `r I(as.character(regioninact[12,1])) ` and the `r I(as.character(regioninact[11,1])) `.


